<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doctor Dashboard - Patient Management</title>
  <style>
    :root {
      --primary-color: #00c3ff;
      --secondary-color: #0077cc;
      --danger-color: #ff4444;
      --warning-color: #ffbb33;
      --success-color: #00C851;
      --dark-bg: #002850;
      --light-bg: #f8f9fa;
      --text-dark: #333;
      --text-light: #fff;
      --sidebar-width: 250px;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #f5f7fa;
      color: var(--text-dark);
      display: flex;
      min-height: 100vh;
    }
    
    /* Sidebar styles remain the same as previous example */
    .sidebar {
      width: var(--sidebar-width);
      background-color: var(--dark-bg);
      color: var(--text-light);
      height: 100vh;
      position: fixed;
      padding: 20px 0;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    }
    
    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .logo svg {
      margin-right: 10px;
      fill: var(--primary-color);
    }
    
    .logo h2 {
      font-size: 20px;
      color: var(--text-light);
    }
    
    .nav-menu {
      margin-top: 30px;
    }
    
    .nav-item {
      padding: 15px 25px;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .nav-item:hover {
      background-color: rgba(0, 195, 255, 0.1);
    }
    
    .nav-item.active {
      background-color: var(--primary-color);
    }
    
    .nav-item svg {
      margin-right: 10px;
      fill: currentColor;
    }
    
    .main-content {
      margin-left: var(--sidebar-width);
      width: calc(100% - var(--sidebar-width));
      padding: 30px;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .user-info {
      display: flex;
      align-items: center;
    }
    
    .user-info img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
      object-fit: cover;
    }
    
    .logout-btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
    }
    
    .logout-btn:hover {
      background-color: var(--secondary-color);
    }
    
    .patient-selector {
      margin-bottom: 30px;
      display: flex;
      align-items: center;
    }
    
    .patient-selector label {
      margin-right: 10px;
      font-weight: 500;
    }
    
    .patient-selector select {
      padding: 8px 15px;
      border-radius: 5px;
      border: 1px solid #ddd;
      min-width: 250px;
    }
    
    .patient-selector button {
      margin-left: 10px;
      padding: 8px 15px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    
    .tab-container {
      margin-bottom: 20px;
    }
    
    .tabs {
      display: flex;
      border-bottom: 1px solid #ddd;
    }
    
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      font-weight: 500;
      color: #666;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
    }
    
    .tab.active {
      color: var(--primary-color);
      border-bottom: 3px solid var(--primary-color);
    }
    
    .tab-content {
      display: none;
      padding: 20px 0;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #555;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
      transition: all 0.3s;
    }
    
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    input:focus, select:focus, textarea:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 3px rgba(0, 195, 255, 0.1);
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: var(--secondary-color);
    }
    
    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--primary-color);
      color: var(--primary-color);
    }
    
    .btn-outline:hover {
      background-color: rgba(0, 195, 255, 0.1);
    }
    
    .history-item {
      padding: 15px;
      border-bottom: 1px solid #eee;
    }
    
    .history-item:last-child {
      border-bottom: none;
    }
    
    .history-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-weight: 500;
    }
    
    .history-date {
      color: #666;
      font-size: 13px;
    }
    
    .history-values {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
    }
    
    .history-value {
      font-size: 14px;
    }
    
    .history-value span:first-child {
      color: #666;
      margin-right: 5px;
    }
    
    .alert {
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      display: flex;
      align-items: flex-start;
    }
    
    .alert-danger {
      background-color: rgba(255, 68, 68, 0.1);
      border-left: 4px solid var(--danger-color);
    }
    
    .alert-warning {
      background-color: rgba(255, 187, 51, 0.1);
      border-left: 4px solid var(--warning-color);
    }
    
    .alert-icon {
      margin-right: 10px;
      flex-shrink: 0;
    }
    
    .alert-content h4 {
      margin-bottom: 5px;
      font-size: 15px;
    }
    
    .alert-content p {
      font-size: 14px;
      color: #666;
    }
    
    .task-list {
      list-style: none;
    }
    
    .task-item {
      display: flex;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }
    
    .task-item:last-child {
      border-bottom: none;
    }
    
    .task-checkbox {
      margin-right: 10px;
    }
    
    .task-text {
      flex-grow: 1;
    }
    
    .task-completed {
      text-decoration: line-through;
      color: #999;
    }
    
    .task-actions {
      margin-left: 10px;
    }
    
    .task-actions button {
      background: none;
      border: none;
      color: #666;
      cursor: pointer;
      font-size: 14px;
    }
    
    .task-actions button:hover {
      color: var(--primary-color);
    }
    
    .add-task {
      display: flex;
      margin-top: 15px;
    }
    
    .add-task input {
      flex-grow: 1;
      margin-right: 10px;
    }
    
    .prescription-item {
      margin-bottom: 15px;
      padding: 15px;
      background-color: white;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .prescription-med {
      font-weight: 500;
      margin-bottom: 5px;
    }
    
    .prescription-details {
      font-size: 13px;
      color: #666;
      margin-bottom: 5px;
    }
    
    .prescription-notes {
      font-size: 13px;
      color: #555;
      padding-left: 10px;
      border-left: 2px solid #eee;
    }
    
    .prescription-actions {
      margin-top: 10px;
      display: flex;
      gap: 10px;
    }
    
    .prescription-actions button {
      padding: 5px 10px;
      font-size: 12px;
      border-radius: 3px;
      cursor: pointer;
    }
    
    .edit-btn {
      background-color: #f8f9fa;
      border: 1px solid #ddd;
    }
    
    .delete-btn {
      background-color: #f8f9fa;
      border: 1px solid #ddd;
      color: var(--danger-color);
    }
    
    @media (max-width: 768px) {
      .sidebar {
        width: 70px;
        overflow: hidden;
      }
      
      .logo h2, .nav-item span {
        display: none;
      }
      
      .logo {
        justify-content: center;
      }
      
      .nav-item {
        justify-content: center;
      }
      
      .nav-item svg {
        margin-right: 0;
      }
      
      .main-content {
        margin-left: 70px;
        width: calc(100% - 70px);
      }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
        <path d="M19 3H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 11h-4v4h-4v-4H6v-4h4V6h4v4h4v4z"/>
      </svg>
      <h2>Smart Care</h2>
    </div>
    
    <div class="nav-menu">
      <div class="nav-item">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
        </svg>
        <span>Dashboard</span>
      </div>
      <div class="nav-item active">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z"/>
        </svg>
        <span>Patients</span>
      </div>
      <div class="nav-item">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
        </svg>
        <span>Appointments</span>
      </div>
      <div class="nav-item">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <path d="M19 3H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 11h-4v4h-4v-4H6v-4h4V6h4v4h4v4z"/>
        </svg>
        <span>Prescriptions</span>
      </div>
      <div class="nav-item">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
        </svg>
        <span>Profile</span>
      </div>
    </div>
  </div>
  
  <!-- Main Content -->
  <div class="main-content">
    <div class="header">
      <h1>Patient Management</h1>
      <div class="user-info">
        <img src="https://randomuser.me/api/portraits/women/65.jpg" alt="Doctor">
        <button class="logout-btn" id="logout-btn">Logout</button>
      </div>
    </div>
    
    <!-- Patient Selector -->
    <div class="patient-selector">
      <label for="patient-select">Select Patient:</label>
      <select id="patient-select">
        <option value="">-- Select a patient --</option>
      </select>
      <button id="refresh-patients">Refresh</button>
    </div>
    
    <!-- Alerts Section -->
    <div id="alerts-container"></div>
    
    <!-- Tabs -->
    <div class="tab-container">
      <div class="tabs">
        <div class="tab active" data-tab="vitals">Vitals</div>
        <div class="tab" data-tab="symptoms">Symptoms</div>
        <div class="tab" data-tab="tasks">Tasks</div>
        <div class="tab" data-tab="prescription">Prescription</div>
      </div>
    </div>
    
    <!-- Vitals Tab -->
    <div class="tab-content active" id="vitals-tab">
      <div class="section-title">Record New Vitals</div>
      <form id="vitals-form">
        <div class="form-grid">
          <div class="form-group">
            <label for="heart-rate">Heart Rate (bpm)</label>
            <input type="number" id="heart-rate" name="heart-rate" placeholder="e.g. 72">
          </div>
          <div class="form-group">
            <label for="blood-pressure">Blood Pressure (mmHg)</label>
            <input type="text" id="blood-pressure" name="blood-pressure" placeholder="e.g. 120/80">
          </div>
          <div class="form-group">
            <label for="temperature">Temperature (°F)</label>
            <input type="number" id="temperature" name="temperature" step="0.1" placeholder="e.g. 98.6">
          </div>
          <div class="form-group">
            <label for="oxygen">Oxygen Saturation (%)</label>
            <input type="number" id="oxygen" name="oxygen" placeholder="e.g. 98">
          </div>
          <div class="form-group">
            <label for="respiratory-rate">Respiratory Rate</label>
            <input type="number" id="respiratory-rate" name="respiratory-rate" placeholder="e.g. 16">
          </div>
          <div class="form-group">
            <label for="weight">Weight (lbs)</label>
            <input type="number" id="weight" name="weight" step="0.1" placeholder="e.g. 175.5">
          </div>
          <div class="form-group">
            <label for="height">Height (in)</label>
            <input type="number" id="height" name="height" placeholder="e.g. 70">
          </div>
          <div class="form-group">
            <label for="bmi">BMI</label>
            <input type="number" id="bmi" name="bmi" step="0.1" placeholder="Calculated automatically" disabled>
          </div>
        </div>
        <div class="form-group">
          <label for="vitals-notes">Notes</label>
          <textarea id="vitals-notes" name="vitals-notes" placeholder="Additional observations..."></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Save Vitals</button>
      </form>
      
      <div class="section-title">Vitals History</div>
      <div id="vitals-history"></div>
    </div>
    
    <!-- Symptoms Tab -->
    <div class="tab-content" id="symptoms-tab">
      <div class="section-title">Current Symptoms</div>
      <form id="symptoms-form">
        <div class="form-group">
          <label for="symptoms">Describe Symptoms</label>
          <textarea id="symptoms" name="symptoms" placeholder="Patient-reported symptoms..."></textarea>
        </div>
        <div class="form-group">
          <label for="symptoms-onset">Onset & Duration</label>
          <input type="text" id="symptoms-onset" name="symptoms-onset" placeholder="When did symptoms begin?">
        </div>
        <div class="form-group">
          <label for="symptoms-severity">Severity (1-10)</label>
          <select id="symptoms-severity" name="symptoms-severity">
            <option value="">Select severity</option>
            <option value="1">1 - Very Mild</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 - Moderate</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10 - Severe</option>
          </select>
        </div>
        <div class="form-group">
          <label for="symptoms-aggravating">Aggravating Factors</label>
          <input type="text" id="symptoms-aggravating" name="symptoms-aggravating" placeholder="What makes symptoms worse?">
        </div>
        <div class="form-group">
          <label for="symptoms-relieving">Relieving Factors</label>
          <input type="text" id="symptoms-relieving" name="symptoms-relieving" placeholder="What makes symptoms better?">
        </div>
        <div class="form-group">
          <label for="symptoms-notes">Clinical Notes</label>
          <textarea id="symptoms-notes" name="symptoms-notes" placeholder="Your observations..."></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Update Symptoms</button>
      </form>
    </div>
    
    <!-- Tasks Tab -->
    <div class="tab-content" id="tasks-tab">
      <div class="section-title">Patient Care Plan</div>
      <ul class="task-list" id="task-list">
        <!-- Tasks will be added here dynamically -->
      </ul>
      
      <div class="add-task">
        <input type="text" id="new-task" placeholder="Add new task...">
        <button class="btn btn-primary" id="add-task-btn">Add</button>
      </div>
    </div>
    
    <!-- Prescription Tab -->
    <div class="tab-content" id="prescription-tab">
      <div class="section-title">New Prescription</div>
      <form id="prescription-form">
        <div class="form-grid">
          <div class="form-group">
            <label for="medication">Medication</label>
            <input type="text" id="medication" name="medication" placeholder="e.g. Lisinopril">
          </div>
          <div class="form-group">
            <label for="dosage">Dosage</label>
            <input type="text" id="dosage" name="dosage" placeholder="e.g. 10mg">
          </div>
          <div class="form-group">
            <label for="frequency">Frequency</label>
            <select id="frequency" name="frequency">
              <option value="">Select frequency</option>
              <option value="once daily">Once daily</option>
              <option value="twice daily">Twice daily</option>
              <option value="three times daily">Three times daily</option>
              <option value="as needed">As needed</option>
            </select>
          </div>
          <div class="form-group">
            <label for="duration">Duration</label>
            <input type="text" id="duration" name="duration" placeholder="e.g. 30 days">
          </div>
        </div>
        <div class="form-group">
          <label for="prescription-notes">Instructions</label>
          <textarea id="prescription-notes" name="prescription-notes" placeholder="Special instructions..."></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Add Prescription</button>
      </form>
      
      <div class="section-title">Current Prescriptions</div>
      <div id="prescriptions-list">
        <!-- Prescriptions will be added here dynamically -->
      </div>
    </div>
  </div>

  <script>
    // Mock backend using localStorage
    class BackendService {
      constructor() {
        this.patientsKey = 'smartcare_patients';
        this.currentDoctorKey = 'smartcare_current_doctor';
        this.initializeData();
      }
      
      initializeData() {
        if (!localStorage.getItem(this.patientsKey)) {
          // Sample patients data
          const patients = [
            {
              id: '1',
              name: 'John Smith',
              age: 45,
              gender: 'Male',
              lastVisit: '2023-05-15',
              vitals: [
                {
                  date: '2023-05-15T10:30:00',
                  heartRate: 112,
                  bloodPressure: '150/95',
                  temperature: 98.7,
                  oxygen: 97,
                  respiratoryRate: 18,
                  weight: 178,
                  height: 70,
                  notes: 'Patient reported dizziness'
                },
                {
                  date: '2023-05-01T09:15:00',
                  heartRate: 78,
                  bloodPressure: '130/85',
                  temperature: 98.4,
                  oxygen: 98,
                  respiratoryRate: 16,
                  weight: 176,
                  height: 70,
                  notes: 'Routine checkup'
                }
              ],
              symptoms: {
                description: 'Headache, dizziness, occasional chest discomfort',
                onset: 'Started 3 days ago, intermittent',
                severity: 5,
                aggravating: 'Physical exertion, stress',
                relieving: 'Rest, hydration',
                notes: 'Symptoms align with recent medication changes'
              },
              tasks: [
                { id: '1', text: 'Review blood pressure logs', completed: true },
                { id: '2', text: 'Schedule cardiac stress test', completed: false },
                { id: '3', text: 'Follow up on potential ADR', completed: false }
              ],
              prescriptions: [
                {
                  id: '1',
                  medication: 'Metoprolol Tartrate',
                  brand: 'Lopressor',
                  dosage: '25mg tablet',
                  frequency: 'Twice daily',
                  duration: '2 weeks',
                  notes: 'Take with food. Monitor heart rate and blood pressure. Report any dizziness or shortness of breath.',
                  date: '2023-05-01'
                },
                {
                  id: '2',
                  medication: 'Atorvastatin Calcium',
                  brand: 'Lipitor',
                  dosage: '20mg tablet',
                  frequency: 'Once daily at bedtime',
                  duration: 'Indefinite',
                  notes: 'Continue indefinitely for cholesterol management. Routine LFTs scheduled.',
                  date: '2022-11-15'
                }
              ]
            },
            {
              id: '2',
              name: 'Emily Johnson',
              age: 32,
              gender: 'Female',
              lastVisit: '2023-05-10',
              vitals: [],
              symptoms: {},
              tasks: [],
              prescriptions: []
            }
          ];
          
          localStorage.setItem(this.patientsKey, JSON.stringify(patients));
        }
        
        if (!localStorage.getItem(this.currentDoctorKey)) {
          const doctor = {
            id: '1',
            name: 'Dr. Sarah Johnson',
            specialization: 'Cardiology',
            email: 'doctor@example.com'
          };
          localStorage.setItem(this.currentDoctorKey, JSON.stringify(doctor));
        }
      }
      
      getPatients() {
        return JSON.parse(localStorage.getItem(this.patientsKey)) || [];
      }
      
      getPatientById(id) {
        const patients = this.getPatients();
        return patients.find(p => p.id === id);
      }
      
      updatePatient(patient) {
        const patients = this.getPatients();
        const index = patients.findIndex(p => p.id === patient.id);
        if (index !== -1) {
          patients[index] = patient;
          localStorage.setItem(this.patientsKey, JSON.stringify(patients));
          return true;
        }
        return false;
      }
      
      getCurrentDoctor() {
        return JSON.parse(localStorage.getItem(this.currentDoctorKey));
      }
    }

    // Main Application
    class DoctorDashboard {
      constructor() {
        this.backend = new BackendService();
        this.currentPatientId = null;
        this.initElements();
        this.bindEvents();
        this.loadPatients();
      }
      
      initElements() {
        // Main elements
        this.patientSelect = document.getElementById('patient-select');
        this.refreshBtn = document.getElementById('refresh-patients');
        this.logoutBtn = document.getElementById('logout-btn');
        
        // Forms
        this.vitalsForm = document.getElementById('vitals-form');
        this.symptomsForm = document.getElementById('symptoms-form');
        this.prescriptionForm = document.getElementById('prescription-form');
        
        // Input fields
        this.heartRateInput = document.getElementById('heart-rate');
        this.bloodPressureInput = document.getElementById('blood-pressure');
        this.temperatureInput = document.getElementById('temperature');
        this.oxygenInput = document.getElementById('oxygen');
        this.respiratoryRateInput = document.getElementById('respiratory-rate');
        this.weightInput = document.getElementById('weight');
        this.heightInput = document.getElementById('height');
        this.bmiInput = document.getElementById('bmi');
        this.vitalsNotesInput = document.getElementById('vitals-notes');
        
        this.symptomsInput = document.getElementById('symptoms');
        this.symptomsOnsetInput = document.getElementById('symptoms-onset');
        this.symptomsSeverityInput = document.getElementById('symptoms-severity');
        this.symptomsAggravatingInput = document.getElementById('symptoms-aggravating');
        this.symptomsRelievingInput = document.getElementById('symptoms-relieving');
        this.symptomsNotesInput = document.getElementById('symptoms-notes');
        
        this.medicationInput = document.getElementById('medication');
        this.dosageInput = document.getElementById('dosage');
        this.frequencyInput = document.getElementById('frequency');
        this.durationInput = document.getElementById('duration');
        this.prescriptionNotesInput = document.getElementById('prescription-notes');
        
        // Task management
        this.taskList = document.getElementById('task-list');
        this.newTaskInput = document.getElementById('new-task');
        this.addTaskBtn = document.getElementById('add-task-btn');
        
        // Display areas
        this.vitalsHistory = document.getElementById('vitals-history');
        this.prescriptionsList = document.getElementById('prescriptions-list');
        this.alertsContainer = document.getElementById('alerts-container');
        
        // Tabs
        this.tabs = document.querySelectorAll('.tab');
        this.tabContents = document.querySelectorAll('.tab-content');
      }
      
      bindEvents() {
        // Patient selection
        this.patientSelect.addEventListener('change', (e) => this.onPatientSelect(e));
        this.refreshBtn.addEventListener('click', () => this.loadPatients());
        
        // Forms
        this.vitalsForm.addEventListener('submit', (e) => this.onVitalsSubmit(e));
        this.symptomsForm.addEventListener('submit', (e) => this.onSymptomsSubmit(e));
        this.prescriptionForm.addEventListener('submit', (e) => this.onPrescriptionSubmit(e));
        
        // Task management
        this.addTaskBtn.addEventListener('click', () => this.addTask());
        this.newTaskInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') this.addTask();
        });
        
        // Tabs
        this.tabs.forEach(tab => {
          tab.addEventListener('click', () => this.switchTab(tab.dataset.tab));
        });
        
        // Logout
        this.logoutBtn.addEventListener('click', () => {
          localStorage.removeItem(this.backend.currentDoctorKey);
          window.location.href = 'doctor-portal.html';
        });
        
        // Auto-calculate BMI
        this.weightInput.addEventListener('input', () => this.calculateBMI());
        this.heightInput.addEventListener('input', () => this.calculateBMI());
      }
      
      loadPatients() {
        const patients = this.backend.getPatients();
        this.patientSelect.innerHTML = '<option value="">-- Select a patient --</option>';
        
        patients.forEach(patient => {
          const option = document.createElement('option');
          option.value = patient.id;
          option.textContent = `${patient.name} (${patient.age} ${patient.gender})`;
          this.patientSelect.appendChild(option);
        });
      }
      
      onPatientSelect(e) {
        this.currentPatientId = e.target.value;
        if (this.currentPatientId) {
          this.loadPatientData();
        } else {
          this.clearPatientData();
        }
      }
      
      loadPatientData() {
        const patient = this.backend.getPatientById(this.currentPatientId);
        if (!patient) return;
        
        // Load vitals history
        this.renderVitalsHistory(patient.vitals);
        
        // Load symptoms
        if (patient.symptoms && Object.keys(patient.symptoms).length > 0) {
          this.symptomsInput.value = patient.symptoms.description || '';
          this.symptomsOnsetInput.value = patient.symptoms.onset || '';
          this.symptomsSeverityInput.value = patient.symptoms.severity || '';
          this.symptomsAggravatingInput.value = patient.symptoms.aggravating || '';
          this.symptomsRelievingInput.value = patient.symptoms.relieving || '';
          this.symptomsNotesInput.value = patient.symptoms.notes || '';
        } else {
          this.symptomsForm.reset();
        }
        
        // Load tasks
        this.renderTasks(patient.tasks);
        
        // Load prescriptions
        this.renderPrescriptions(patient.prescriptions);
        
        // Check for alerts
        this.checkForAlerts(patient);
      }
      
      clearPatientData() {
        this.vitalsForm.reset();
        this.symptomsForm.reset();
        this.prescriptionForm.reset();
        this.vitalsHistory.innerHTML = '';
        this.taskList.innerHTML = '';
        this.prescriptionsList.innerHTML = '';
        this.alertsContainer.innerHTML = '';
      }
      
      onVitalsSubmit(e) {
        e.preventDefault();
        if (!this.currentPatientId) {
          alert('Please select a patient first');
          return;
        }
        
        const patient = this.backend.getPatientById(this.currentPatientId);
        if (!patient) return;
        
        const newVital = {
          date: new Date().toISOString(),
          heartRate: parseInt(this.heartRateInput.value),
          bloodPressure: this.bloodPressureInput.value,
          temperature: parseFloat(this.temperatureInput.value),
          oxygen: parseInt(this.oxygenInput.value),
          respiratoryRate: parseInt(this.respiratoryRateInput.value),
          weight: parseFloat(this.weightInput.value),
          height: parseInt(this.heightInput.value),
          notes: this.vitalsNotesInput.value
        };
        
        if (!patient.vitals) patient.vitals = [];
        patient.vitals.unshift(newVital);
        
        if (this.backend.updatePatient(patient)) {
          this.renderVitalsHistory(patient.vitals);
          this.vitalsForm.reset();
          this.checkForAlerts(patient);
          alert('Vitals recorded successfully');
        } else {
          alert('Error saving vitals');
        }
      }
      
      onSymptomsSubmit(e) {
        e.preventDefault();
        if (!this.currentPatientId) {
          alert('Please select a patient first');
          return;
        }
        
        const patient = this.backend.getPatientById(this.currentPatientId);
        if (!patient) return;
        
        patient.symptoms = {
          description: this.symptomsInput.value,
          onset: this.symptomsOnsetInput.value,
          severity: this.symptomsSeverityInput.value,
          aggravating: this.symptomsAggravatingInput.value,
          relieving: this.symptomsRelievingInput.value,
          notes: this.symptomsNotesInput.value,
          lastUpdated: new Date().toISOString()
        };

        if (this.backend.updatePatient(patient)) {
          this.checkForAlerts(patient);
          alert('Symptoms updated successfully');
        } else {
          alert('Error updating symptoms');
        }
      }
      
      onPrescriptionSubmit(e) {
        e.preventDefault();
        if (!this.currentPatientId) {
          alert('Please select a patient first');
          return;
        }
        
        const patient = this.backend.getPatientById(this.currentPatientId);
        if (!patient) return;
        
        const newPrescription = {
          id: Date.now().toString(),
          medication: this.medicationInput.value,
          dosage: this.dosageInput.value,
          frequency: this.frequencyInput.value,
          duration: this.durationInput.value,
          notes: this.prescriptionNotesInput.value,
          date: new Date().toISOString()
        };
        
        if (!patient.prescriptions) patient.prescriptions = [];
        patient.prescriptions.push(newPrescription);
        
        if (this.backend.updatePatient(patient)) {
          this.renderPrescriptions(patient.prescriptions);
          this.prescriptionForm.reset();
          this.checkForAlerts(patient);
          alert('Prescription added successfully');
        } else {
          alert('Error adding prescription');
        }
      }
      
      addTask() {
        if (!this.currentPatientId) {
          alert('Please select a patient first');
          return;
        }
        
        const taskText = this.newTaskInput.value.trim();
        if (!taskText) return;
        
        const patient = this.backend.getPatientById(this.currentPatientId);
        if (!patient) return;
        
        const newTask = {
          id: Date.now().toString(),
          text: taskText,
          completed: false
        };
        
        if (!patient.tasks) patient.tasks = [];
        patient.tasks.push(newTask);
        
        if (this.backend.updatePatient(patient)) {
          this.renderTasks(patient.tasks);
          this.newTaskInput.value = '';
        }
      }
      
      deleteTask(taskId) {
        const patient = this.backend.getPatientById(this.currentPatientId);
        if (!patient) return;
        
        patient.tasks = patient.tasks.filter(task => task.id !== taskId);
        if (this.backend.updatePatient(patient)) {
          this.renderTasks(patient.tasks);
        }
      }
      
      toggleTask(taskId) {
        const patient = this.backend.getPatientById(this.currentPatientId);
        if (!patient) return;
        
        const task = patient.tasks.find(t => t.id === taskId);
        if (task) {
          task.completed = !task.completed;
          if (this.backend.updatePatient(patient)) {
            this.renderTasks(patient.tasks);
          }
        }
      }
      
      renderTasks(tasks) {
        this.taskList.innerHTML = '';
        
        tasks.forEach(task => {
          const li = document.createElement('li');
          li.className = 'task-item';
          li.innerHTML = `
            <input type="checkbox" class="task-checkbox" 
                   id="task-${task.id}" ${task.completed ? 'checked' : ''}>
            <label for="task-${task.id}" 
                   class="task-text ${task.completed ? 'task-completed' : ''}">
              ${task.text}
            </label>
            <div class="task-actions">
              <button class="delete-task">Delete</button>
            </div>
          `;
          
          li.querySelector('.task-checkbox').addEventListener('change', () => {
            this.toggleTask(task.id);
          });
          
          li.querySelector('.delete-task').addEventListener('click', () => {
            this.deleteTask(task.id);
          });
          
          this.taskList.appendChild(li);
        });
      }
      
      renderPrescriptions(prescriptions) {
        this.prescriptionsList.innerHTML = '';
        
        prescriptions.forEach(prescription => {
          const div = document.createElement('div');
          div.className = 'prescription-item';
          div.innerHTML = `
            <div class="prescription-med">
              ${prescription.medication}
              ${prescription.brand ? `<span class="brand">(${prescription.brand})</span>` : ''}
            </div>
            <div class="prescription-details">
              ${prescription.dosage} • ${prescription.frequency} • ${prescription.duration}
            </div>
            ${prescription.notes ? `<div class="prescription-notes">${prescription.notes}</div>` : ''}
            <div class="prescription-actions">
              <button class="btn edit-btn">Edit</button>
              <button class="btn delete-btn">Delete</button>
            </div>
          `;
          
          div.querySelector('.delete-btn').addEventListener('click', () => {
            this.deletePrescription(prescription.id);
          });
          
          div.querySelector('.edit-btn').addEventListener('click', () => {
            this.editPrescription(prescription);
          });
          
          this.prescriptionsList.appendChild(div);
        });
      }
      
      deletePrescription(prescriptionId) {
        const patient = this.backend.getPatientById(this.currentPatientId);
        if (!patient) return;
        
        patient.prescriptions = patient.prescriptions.filter(p => p.id !== prescriptionId);
        if (this.backend.updatePatient(patient)) {
          this.renderPrescriptions(patient.prescriptions);
        }
      }
      
      editPrescription(prescription) {
        // Implementation for editing prescriptions
        // You can populate the form with existing values
        this.medicationInput.value = prescription.medication;
        this.dosageInput.value = prescription.dosage;
        this.frequencyInput.value = prescription.frequency;
        this.durationInput.value = prescription.duration;
        this.prescriptionNotesInput.value = prescription.notes;
      }
      
      renderVitalsHistory(vitals) {
        this.vitalsHistory.innerHTML = '';
        
        vitals.forEach(vital => {
          const div = document.createElement('div');
          div.className = 'history-item';
          div.innerHTML = `
            <div class="history-header">
              <span>${new Date(vital.date).toLocaleDateString()}</span>
              <span class="history-date">Recorded by ${this.backend.getCurrentDoctor().name}</span>
            </div>
            <div class="history-values">
              ${this.createVitalElement('Heart Rate', vital.heartRate, 'bpm')}
              ${this.createVitalElement('Blood Pressure', vital.bloodPressure, 'mmHg')}
              ${this.createVitalElement('Temperature', vital.temperature, '°F')}
              ${this.createVitalElement('Oxygen', vital.oxygen, '%')}
              ${this.createVitalElement('Respiratory Rate', vital.respiratoryRate, '')}
              ${this.createVitalElement('Weight', vital.weight, 'lbs')}
            </div>
            ${vital.notes ? `<div class="history-notes">${vital.notes}</div>` : ''}
          `;
          
          this.vitalsHistory.appendChild(div);
        });
      }
      
      createVitalElement(label, value, unit) {
        const alertClass = this.getVitalAlertClass(label, value);
        return `
          <div class="history-value ${alertClass}">
            <span>${label}:</span>
            <span>${value} ${unit}</span>
          </div>
        `;
      }
      
      getVitalAlertClass(label, value) {
        // Add your medical logic here for alerts
        if (label === 'Heart Rate' && value > 100) return 'alert-high';
        if (label === 'Blood Pressure') {
          const [systolic, diastolic] = value.split('/').map(Number);
          if (systolic > 140 || diastolic > 90) return 'alert-high';
        }
        if (label === 'Oxygen' && value < 95) return 'alert-low';
        return '';
      }
      
      checkForAlerts(patient) {
        this.alertsContainer.innerHTML = '';
        
        // Check vitals
        const latestVital = patient.vitals?.[0];
        if (latestVital) {
          if (latestVital.heartRate > 100) {
            this.createAlert('High Heart Rate', 
              `Elevated heart rate detected: ${latestVital.heartRate} bpm`, 'danger');
          }
          
          if (latestVital.bloodPressure) {
            const [systolic, diastolic] = latestVital.bloodPressure.split('/').map(Number);
            if (systolic > 140 || diastolic > 90) {
              this.createAlert('High Blood Pressure', 
                `Elevated BP detected: ${latestVital.bloodPressure} mmHg`, 'warning');
            }
          }
        }
        
        // Check drug interactions
        const prescriptions = patient.prescriptions || [];
        if (prescriptions.some(p => p.medication.includes('Metoprolol'))) {
          this.createAlert('Beta-Blocker Alert', 
            'Patient is on beta-blocker therapy. Monitor for bradycardia and hypotension.', 'warning');
        }
      }
      
      createAlert(title, message, type) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type}`;
        alertDiv.innerHTML = `
          <div class="alert-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
            </svg>
          </div>
          <div class="alert-content">
            <h4>${title}</h4>
            <p>${message}</p>
          </div>
        `;
        this.alertsContainer.appendChild(alertDiv);
      }
      
      calculateBMI() {
        const weight = parseFloat(this.weightInput.value);
        const height = parseInt(this.heightInput.value);
        
        if (weight && height) {
          const bmi = (weight / (height * height)) * 703;
          this.bmiInput.value = bmi.toFixed(1);
        } else {
          this.bmiInput.value = '';
        }
      }
      
      switchTab(tabId) {
        // Hide all tab contents
        this.tabContents.forEach(content => content.classList.remove('active'));
        
        // Deactivate all tabs
        this.tabs.forEach(tab => tab.classList.remove('active'));
        
        // Show selected tab content
        document.getElementById(`${tabId}-tab`).classList.add('active');
        
        // Activate selected tab
        document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
      }
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', () => {
      const dashboard = new DoctorDashboard();
      
      // Check authentication
      if (!dashboard.backend.getCurrentDoctor()) {
        window.location.href = 'doctor-portal.html';
      }
    });
  </script>
</body>
</html>
